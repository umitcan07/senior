services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Build-time args (for Vite env vars that need to be in the bundle)
        # Priority: .env.local > .env > default empty
        VITE_CLERK_PUBLISHABLE_KEY: ${VITE_CLERK_PUBLISHABLE_KEY:-}
    container_name: tanstack-app
    restart: unless-stopped
    env_file:
      - .env.local # Load .env.local first (higher priority)
      - .env # Then load .env as fallback
    ports:
      - "${APP_PORT:-3000}:3000"
    environment:
      NODE_ENV: production
      DATABASE_URL: ${DATABASE_URL}
      PORT: 3000
      VITE_CLERK_PUBLISHABLE_KEY: ${VITE_CLERK_PUBLISHABLE_KEY:-}
